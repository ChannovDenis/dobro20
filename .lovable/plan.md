# План выполнен ✅

## Что было сделано

### 1. Автоматическое создание топика при первом сообщении

- Добавлена функция `ensureTopicExists` в `useChat.ts`
- При отправке первого сообщения без активного топика автоматически создаётся "general" топик
- Заголовок топика берётся из первого сообщения (первые 50 символов)
- URL обновляется с новым `topicId` через callback `onTopicAutoCreated`

### 2. Исправлены ошибки 406 в консоли

- В `TenantContext.tsx` заменён `.single()` на `.maybeSingle()` 
- Добавлена проверка на `!data` для корректной обработки отсутствия tenant

### 3. Улучшена передача topicId в saveMessageToDB

- Добавлен параметр `overrideTopicId` для использования свежесозданного ID
- Это гарантирует, что сообщения сохраняются в только что созданный топик

## Файлы изменены

| Файл | Изменения |
|------|-----------|
| `src/hooks/useChat.ts` | Добавлен `ensureTopicExists`, обновлён `saveMessageToDB`, добавлен callback |
| `src/pages/Chat.tsx` | Добавлен `handleTopicAutoCreated` callback |
| `src/contexts/TenantContext.tsx` | Исправлен `.maybeSingle()`, добавлена проверка на null |

## Ожидаемое поведение

1. ✅ Любое сообщение в чате автоматически привязывается к топику
2. ✅ История сохраняется в БД и доступна после перезагрузки
3. ✅ URL обновляется с `topicId` для возможности поделиться/вернуться
4. ✅ Консоль чистая от ошибок 406
