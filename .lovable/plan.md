

# План реализации: Доработки страниц Добросервис

## Обзор задач

Пользователь предоставил 6 детальных заданий для доработки приложения. Рекомендуемый порядок выполнения (по зависимостям):

| # | Задание | Время | Зависимости |
|---|---------|-------|-------------|
| 1 | Кнопка «Спросить AI» на карточках | 20 мин | — |
| 6 | Шаблоны в чате (кнопка +) | 20 мин | — |
| 4 | White-label 3 темы | 30 мин | Частично готово |
| 3 | Список экспертов | 25 мин | — |
| 2 | Экран эксперта с бронированием | 30 мин | Задание 3 |
| 5 | Партнёрская панель | 30 мин | Задание 4 |

---

## Задание 1: Кнопка «Спросить AI» на карточках ленты

### Что нужно сделать:
1. Добавить floating-кнопку "Спросить AI" на `FeedCard`
2. Добавить кнопку "Записаться к эксперту" 
3. Передавать контекст карточки в чат через query params
4. В `Chat.tsx` читать query params и показывать бейдж контекста

### Файлы для изменения:
| Файл | Изменения |
|------|-----------|
| `src/components/feed/FeedCard.tsx` | Добавить 2 кнопки (AI + эксперт) |
| `src/data/mockData.ts` | Добавить `serviceType` в `FeedItem` для маппинга |
| `src/pages/Chat.tsx` | Читать `?prompt=` и `?service=`, показывать бейдж контекста |

### Детали реализации:
```text
FeedCard.tsx:
┌────────────────────────────────┐
│  [Existing content...]         │
│                                │
│           ┌──────────────────┐ │
│           │ 🤖 Спросить AI   │ │ ← floating pill, bottom-right
│           └──────────────────┘ │
│           ┌──────────────────┐ │
│           │ 📅 К эксперту    │ │ ← outline, smaller
│           └──────────────────┘ │
└────────────────────────────────┘

Chat.tsx при открытии с ?prompt=...:
┌────────────────────────────────┐
│  X            AI Assistant     │
├────────────────────────────────┤
│ ┌────────────────────────────┐ │
│ │ Контекст: {title}     [X] │ │ ← dismissable badge
│ └────────────────────────────┘ │
│                                │
│  [Chat input pre-filled]       │
└────────────────────────────────┘
```

---

## Задание 6: Шаблоны в чате (кнопка «+»)

### Что нужно сделать:
1. Переделать меню кнопки "+" на красивые шаблоны с иконками
2. 8 шаблонов с цветными иконками и описаниями
3. При клике вставлять prompt в input (не отправлять)

### Файлы для изменения:
| Файл | Изменения |
|------|-----------|
| `src/components/chat/ChatInput.tsx` | Полностью переделать TemplatesModal |
| `src/components/chat/TemplatesModal.tsx` | Новый компонент (опционально) |

### Шаблоны:
```text
[⚖️] Юридическое обращение
     Составить жалобу, претензию или заявление

[❤️] Вопрос про здоровье
     Расшифровать анализы или описать симптомы

[🧮] Проверить смету
     Оценить стоимость ремонта или услуг

[🧾] Анализ чека
     Проверить чек на ошибки и переплаты

[✨] Подобрать стиль
     Капсульный гардероб или образ

[🛡️] Проверить на мошенничество
     Подозрительное сообщение или сайт

[💰] Финансовый вопрос
     Налоги, кредиты, инвестиции

[🐾] Вопрос про питомца
     Здоровье, питание или поведение
```

---

## Задание 4: White-label темы

### Текущее состояние:
- ✅ `TenantContext.tsx` уже создан
- ✅ `useTenant.ts` hook готов
- ✅ Таблица `tenants` в БД с seed data
- ❌ CSS variables не применяются к компонентам
- ❌ Нет переключателя в Settings

### Что нужно доделать:
1. Добавить CSS variables в `index.css` для tenant-цветов
2. Обновить компоненты для использования tenant-данных:
   - `TopBar` → логотип и название
   - `Chat` → AI name из tenant
   - `ServiceGrid` → фильтрация по `enabled_services`
3. Добавить переключатель тем в Settings

### Файлы для изменения:
| Файл | Изменения |
|------|-----------|
| `src/index.css` | CSS variables fallback + tenant override |
| `src/pages/Settings.tsx` | Секция "Тема" с 3 кнопками |
| `src/pages/Chat.tsx` | Использовать `tenant.aiName` |
| `src/pages/Services.tsx` | Фильтровать по `enabledServices` |

---

## Задание 3: Список экспертов `/service/:id`

### Текущее состояние:
- Страница `ServiceDetail.tsx` уже существует
- Показывает список экспертов для сервиса

### Что нужно доработать:
1. Добавить фильтры: "Все", "Онлайн сейчас", "Топ рейтинг"
2. Улучшить карточки экспертов
3. Добавить кнопку "Записаться" на каждую карточку
4. При клике переходить на детальную страницу эксперта

### Файлы для изменения:
| Файл | Изменения |
|------|-----------|
| `src/pages/ServiceDetail.tsx` | Переименовать в ExpertsList, добавить фильтры |
| `src/pages/ExpertDetail.tsx` | Новая страница детального бронирования |
| `src/data/mockData.ts` | Расширить данные экспертов |
| `src/App.tsx` | Добавить route `/service/:id/expert/:expertId` |

---

## Задание 2: Экран эксперта с бронированием

### Что нужно создать:
1. Новая страница `/service/:id/expert/:expertId`
2. Hero-секция с аватаром и статистикой
3. Выбор даты (горизонтальный скролл 7 дней)
4. Выбор времени (grid слотов)
5. Тип консультации (Онлайн / Чат)
6. Кнопка "Записаться" с ценой

### Новые файлы:
| Файл | Описание |
|------|----------|
| `src/pages/ExpertDetail.tsx` | Полная страница бронирования |
| `src/components/booking/DatePicker.tsx` | Горизонтальный выбор дат |
| `src/components/booking/TimeSlots.tsx` | Grid слотов времени |
| `src/components/booking/ConsultationType.tsx` | Выбор типа консультации |

### Макет:
```text
┌────────────────────────────────┐
│ ←                              │
├────────────────────────────────┤
│         [Avatar 120px]         │
│      Алексей Петров            │
│   ⭐ 4.9 · Юрист · Семейное    │
├────────────────────────────────┤
│  [12 лет] [5000+] [4.9]        │
│   Опыт  Консультаций Рейтинг   │
├────────────────────────────────┤
│  📞   📹   💬   📄             │
├────────────────────────────────┤
│ Выберите дату                  │
│ [Пн 10] [Вт 11] [Ср 12] ...   │
├────────────────────────────────┤
│ Выберите время                 │
│ [10:00] [10:30] [11:00] ...   │
├────────────────────────────────┤
│ ┌──────────┐ ┌──────────┐     │
│ │ Онлайн   │ │   Чат    │     │
│ │ от 2000₽ │ │ от 1500₽ │     │
│ └──────────┘ └──────────┘     │
├────────────────────────────────┤
│ [   Записаться · 2000 ₽    ]   │
└────────────────────────────────┘
```

---

## Задание 5: Партнёрская панель `/admin`

### Что нужно создать:
1. Новая страница `/admin`
2. Метрики: DAU, обращения AI, записи к экспертам
3. График активности (mock)
4. Таблица популярных сервисов
5. Список последних эскалаций
6. Ссылка из Settings

### Новые файлы:
| Файл | Описание |
|------|----------|
| `src/pages/Admin.tsx` | Главная страница админки |
| `src/components/admin/MetricsGrid.tsx` | 4 карточки метрик |
| `src/components/admin/ActivityChart.tsx` | Mock-график |
| `src/components/admin/TopServicesTable.tsx` | Таблица сервисов |
| `src/components/admin/RecentEscalations.tsx` | Список записей |

### Файлы для изменения:
| Файл | Изменения |
|------|-----------|
| `src/App.tsx` | Добавить route `/admin` |
| `src/pages/Settings.tsx` | Добавить ссылку "Панель партнёра" |

---

## Рекомендуемый порядок реализации

**Шаг 1** — Задания 1 + 6 (параллельно, нет зависимостей):
- Кнопка "Спросить AI" на FeedCard
- Шаблоны в ChatInput

**Шаг 2** — Задание 4 (White-label):
- Интеграция tenant в UI
- Переключатель тем в Settings

**Шаг 3** — Задания 3 + 2 (последовательно):
- Улучшение списка экспертов
- Детальная страница бронирования

**Шаг 4** — Задание 5:
- Партнёрская панель

---

## Технические детали

### Маппинг категорий FeedItem → сервисы:
```typescript
const categoryToService: Record<string, string> = {
  "Сад": "garden",
  "Рассада": "garden",
  "ЗОЖ": "wellness",
  "Фитнес": "wellness",
  "Безопасность": "security",
  "Право": "lawyer",
  "Психология": "psychologist",
  "Финансы": "finance",
  "Питомцы": "vet",
  "Здоровье": "doctor",
};
```

### Структура данных эксперта (расширенная):
```typescript
interface Expert {
  id: string;
  name: string;
  specialty: string;
  rating: number;
  reviews: number;
  avatar: string;
  price: string;
  priceChat: string;
  available: boolean;
  experience: string; // "12 лет"
  consultations: number; // 5000
  nextSlot?: string; // "14:00"
  timeSlots: string[]; // ["10:00", "10:30", ...]
}
```

---

## Готовность к реализации

Все 6 заданий детально описаны. Предлагаю начать с **Задания 1** (кнопка "Спросить AI" на карточках) — это самое быстрое и даёт видимый результат.

