
# План интеграции AI-стилиста в чат и минимализация ленты

## Обзор

Интегрируем функционал AI-стилиста из предыдущего проекта в основной чат. Чат станет универсальным помощником с динамическими кнопками действий, которые появляются по мере диалога. Также упростим интерфейс ленты — сократим иконки до минимума.

---

## Часть 1: Минималистичная лента

**Текущее состояние:** 4 иконки справа (лайк, комментарии, поделиться, закладка)

**Новый дизайн:**
- Оставить только **2 иконки**: Лайк и Поделиться
- Убрать счётчики под иконками — только сами иконки
- Сделать их компактнее и полупрозрачными
- Убрать индикатор "Листай" для чистоты

**Изменяемый файл:** `src/components/feed/FeedCard.tsx`

---

## Часть 2: Расширенный чат с функционалом стилиста

### 2.1 Расширенные типы сообщений

Создаём новый файл `src/types/chat.ts`:

```text
┌─────────────────────────────────────────────────────────────┐
│  Message                                                     │
├─────────────────────────────────────────────────────────────┤
│  id: string                                                  │
│  role: "user" | "assistant"                                  │
│  content: string                                             │
│  imageUrl?: string          — Фото пользователя              │
│  resultImageUrl?: string    — Результат примерки             │
│  buttons?: ActionButton[]   — Динамические кнопки            │
│  isProcessing?: boolean     — Индикатор загрузки             │
│  colorPalette?: string[]    — Палитра цветотипа              │
│  trendGallery?: TrendItem[] — Галерея трендов                │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 Контекстные действия

**Файл:** `src/constants/chatActions.ts`

Кнопки появляются по мере разговора:
- После приветствия: "Примерить образ", "Цветотип", "Тренды 2026"
- После загрузки фото: "Попробовать другой стиль", "Анализ цветотипа"
- После анализа: "Подобрать гардероб", "Где купить"

### 2.3 Новые компоненты чата

**Создаём:**
1. `src/components/chat/ActionButtons.tsx` — Динамические кнопки действий
2. `src/components/chat/ImageUploader.tsx` — Загрузка фото
3. `src/components/chat/ColorPalette.tsx` — Отображение цветотипа
4. `src/components/chat/TrendGallery.tsx` — Карусель трендов
5. `src/components/chat/BeforeAfterSlider.tsx` — Сравнение до/после

### 2.4 Обновлённый хук useChat

**Файл:** `src/hooks/useChat.ts`

Добавляем:
- Управление загруженными фото
- Обработку действий (примерка, цветотип, тренды)
- Состояние для динамических кнопок
- Интеграцию с Edge Functions

### 2.5 Edge Functions

**Создаём новые:**

1. `supabase/functions/lisa-stylist/index.ts`
   - Персонализированный стилист-бот
   - Системный промпт для Лизы
   - Стриминг ответов

2. `supabase/functions/colortype-analyzer/index.ts`
   - Анализ фото на цветотип
   - Использует `google/gemini-2.5-pro` для vision

3. `supabase/functions/virtual-tryon/index.ts`  
   - Виртуальная примерка
   - Использует `google/gemini-2.5-flash-image`

**Обновляем config.toml:**
```toml
[functions.lisa-stylist]
verify_jwt = false

[functions.colortype-analyzer]
verify_jwt = false

[functions.virtual-tryon]
verify_jwt = false
```

---

## Часть 3: Обновлённый интерфейс чата

**Файл:** `src/pages/Chat.tsx`

Изменения:
- Персона "Лиза" с аватаром при разговоре о стиле
- Динамические кнопки действий после каждого ответа
- Кнопка загрузки фото в поле ввода
- Карусель трендов inline в чате
- Палитра цветов после анализа цветотипа

**Файл:** `src/components/chat/ChatMessage.tsx`

Расширяем для отображения:
- Картинок (загруженных и сгенерированных)
- Кнопок действий внутри сообщения
- Слайдера до/после для примерки
- Цветовой палитры цветотипа

---

## Часть 4: Каталог одежды для примерки

**Файл:** `src/constants/clothing.ts`

```text
Категории:
├── Верх (футболки, рубашки, свитера)
├── Низ (джинсы, брюки, юбки)  
├── Платья
├── Верхняя одежда (куртки, пальто)
└── Аксессуары
```

**Файл:** `src/constants/trends.ts`

Тренды 2026 с изображениями:
- Неоновые акценты
- Оверсайз блейзеры
- Эко-материалы
- Y2K возвращение

---

## Часть 5: Постепенное раскрытие функционала

### Логика появления функций

1. **Первое сообщение** → Базовые подсказки ("Спросить юриста", "Про здоровье")
2. **Упоминание стиля/одежды** → Появляется "Лиза", кнопки стилиста
3. **Загрузка фото** → Кнопки анализа и примерки
4. **После примерки** → Кнопки "Где купить", "Другой стиль"

### Триггеры для Лизы

Ключевые слова в сообщении:
- "стиль", "одежда", "образ", "примерить", "цветотип", "мода", "тренд"

При обнаружении — переключаемся на промпт Лизы.

---

## Порядок реализации

1. **Минимализация ленты** — FeedCard.tsx (сократить до 2 иконок)
2. **Типы чата** — создать src/types/chat.ts
3. **Константы** — chatActions.ts, clothing.ts, trends.ts
4. **Edge Functions** — lisa-stylist, colortype-analyzer, virtual-tryon
5. **Компоненты чата** — ActionButtons, ImageUploader, ColorPalette, TrendGallery
6. **Обновить useChat** — добавить логику действий
7. **Обновить ChatMessage** — рендер расширенных сообщений
8. **Обновить Chat.tsx** — интеграция всего функционала

---

## Техническая архитектура

```text
┌────────────────────────────────────────────────────────────────┐
│                         Chat.tsx                               │
├────────────────────────────────────────────────────────────────┤
│  ┌──────────────────┐  ┌──────────────────┐                    │
│  │  ChatMessage     │  │  ActionButtons   │                    │
│  │  - text          │  │  - tryon         │                    │
│  │  - images        │  │  - colortype     │                    │
│  │  - palette       │  │  - trends        │                    │
│  │  - gallery       │  │  - products      │                    │
│  └──────────────────┘  └──────────────────┘                    │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  ChatInput + ImageUploader                               │  │
│  └──────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌────────────────────────────────────────────────────────────────┐
│                    Edge Functions                              │
├────────────────────────────────────────────────────────────────┤
│  chat/               — Общий чат                               │
│  lisa-stylist/       — Стилист (gemini-flash + streaming)      │
│  colortype-analyzer/ — Анализ цветотипа (gemini-pro + vision)  │
│  virtual-tryon/      — Примерка (gemini-flash-image)           │
└────────────────────────────────────────────────────────────────┘
```

---

## Файлы для создания/изменения

### Новые файлы:
- `src/types/chat.ts`
- `src/constants/chatActions.ts`
- `src/constants/clothing.ts`
- `src/constants/trends.ts`
- `src/components/chat/ActionButtons.tsx`
- `src/components/chat/ImageUploader.tsx`
- `src/components/chat/ColorPalette.tsx`
- `src/components/chat/TrendGallery.tsx`
- `supabase/functions/lisa-stylist/index.ts`
- `supabase/functions/colortype-analyzer/index.ts`
- `supabase/functions/virtual-tryon/index.ts`

### Изменяемые файлы:
- `src/components/feed/FeedCard.tsx` — минимализация
- `src/hooks/useChat.ts` — расширенная логика
- `src/components/chat/ChatMessage.tsx` — расширенный рендер
- `src/components/chat/ChatInput.tsx` — добавить кнопку фото
- `src/pages/Chat.tsx` — интеграция
- `supabase/config.toml` — новые функции
